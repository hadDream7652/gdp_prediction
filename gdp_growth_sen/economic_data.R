library(rsdmx)
library(dplyr)
library(Knoema)
library(haven)
library(tidyr)

var_eco <- as.data.frame(readSDMX("https://nso-senegal.opendataforafrica.org/api/1.0/sdmx/data/iogsnwg?accesskey=wcafwcg?key=NGDPVA_R_ISIC4_C19_XDC+NGDPVA_R_ISIC4_C20_XDC+NGDPVA_R_ISIC4_D_XDC+NGDPVA_R_ISIC4_E_XDC+NGDPVA_R_ISIC4_G_XDC+NGDPVA_R_ISIC4_K_XDC.2014"))
PIB <- as.data.frame(readSDMX("https://senegal.opendataforafrica.org/api/1.0/sdmx/data/rzjjtyd?key=1"))
var_eco<- var_eco %>% select(last_col(1), last_col(0), NOMFR_INDICATOR)
var_eco <- var_eco %>% pivot_wider(names_from = NOMFR_INDICATOR, values_from = OBS_VALUE)
var_eco <- var_eco %>% select(-`PRODUIT INTERIEUR BRUT (en milliards de FCFA)`)

write_dta(PIB, 'data/PIB.dta')

{
  var_eco <- var_eco %>% rename(PIB = Valeur)
  var_eco <- var_eco %>% rename(VA_sec_prim = `VALEUR AJOUTEE (VA) DU SECTEUR PRIMAIRE (en milliards de FCFA)`)
  var_eco <- var_eco %>% rename(agri = `AGRICULTURE ET ACTIVITES ANNEXES`)
  var_eco <- var_eco %>% rename(elevage = `ELEVAGE ET CHASSE`)
  var_eco <- var_eco %>% rename(sylviculture = `SYLVICULTURE, EXPLOITATION FORESTIÈRE ET ACTIVITÉS DE SOUTIEN`)
  var_eco <- var_eco %>% rename(peche = `PECHE, AQUACULTURE ET PISCICULTURE`)
  var_eco <- var_eco %>% rename(VA_sec_secondaire = `VALEUR AJOUTEE (VA) DU SECTEUR SECONDAIRE (en milliards de FCFA)`)
  var_eco <- var_eco %>% rename(activite_extractive = `ACTIVITES EXTRACTIVES`)
  var_eco <- var_eco %>% rename(fabri_prod_agro_alim = `FABRICATION DE PRODUITS AGRO-ALIMENTAIRES`)
  var_eco <- var_eco %>% rename(rafinage_petrole = `RAFINAGE DU PETROLE ET COKEFACTION`)
  var_eco <- var_eco %>% rename(fabri_prod_chim = `FABRICATION DE PRODUITS CHIMIQUES DE var_eco`)
  var_eco <- var_eco %>% rename(fabri_ciment = `FABRICATION DE CIMENT ET D'AUTRES MATERIAUX DE CONSTRUCTION`)
  var_eco <- var_eco %>% rename(fabri_autres_prod_manu = `FABRICATION D'AUTRES PRODUITS MANUFACTURIERS`)
  var_eco <- var_eco %>% rename(prod_elec_gaz = `PRODUCTION ET DISTRIBUTION D'ÉLECTRICITÉ ET DE GAZ`)
  var_eco <- var_eco %>% rename(prod_eau_assa = `PRODUCTION ET DISTRIBUTION D'EAU, ASSAINISSEMENT ET TRAITEMENT DES DECHETS`)
  var_eco <- var_eco %>% rename(construction = `CONSTRUCTION`)
  var_eco <- var_eco %>% rename(VA_sec_ter = `VALEUR AJOUTEE (VA) DU SECTEUR TERTIAIRE (en milliards de FCFA)`)
  var_eco <- var_eco %>% rename(commerce = `COMMERCE`)
  var_eco <- var_eco %>% rename(transport = `TRANSPORTS`)
  var_eco <- var_eco %>% rename(hebergement_restauration = `HEBERGEMENT ET RESTAURATION`)
  var_eco <- var_eco %>% rename(information_communication = `INFORMATION ET COMMUNICATION`)
  var_eco <- var_eco %>% rename(activites_financieres_assurance = `ACTIVITES FINANCIERES ET D'ASSURANCE`)
  var_eco <- var_eco %>% rename(activites_immobilieres = `ACTIVITES  IMMOBILIERES`)
  var_eco <- var_eco %>% rename(services_aux_entreprises = `SERVICES AUX ENTREPRISES`)
  var_eco <- var_eco %>% rename(activites_admin_pub_ens_sante = `ACTIVITES D'ADMINISTRATION PUBLIQUE, D'ENSEIGNEMENT ET DE SANTE`)
  var_eco <- var_eco %>% rename(activites_domestiques = `ACTIVITES DOMESTIQUES`)
  var_eco <- var_eco %>% rename(autres_activites_services = `AUTRES ACTIVITES DE SERVICES`)
  var_eco <- var_eco %>% rename(taxes_nettes_produits = `TAXES NETTES SUR LES PRODUITS`)
}
{
  var_eco$agri = as.numeric(var_eco$agri)
  var_eco$elevage = as.numeric(var_eco$elevage)
  var_eco$sylviculture = as.numeric(var_eco$sylviculture)
  var_eco$peche = as.numeric(var_eco$peche)
  var_eco$VA_sec_secondaire = as.numeric(var_eco$VA_sec_secondaire)
  var_eco$activite_extractive = as.numeric(var_eco$activite_extractive)
  var_eco$fabri_prod_agro_alim = as.numeric(var_eco$fabri_prod_agro_alim)
  var_eco$rafinage_petrole = as.numeric(var_eco$rafinage_petrole)
  var_eco$fabri_prod_chim = as.numeric(var_eco$fabri_prod_chim)
  var_eco$fabri_ciment = as.numeric(var_eco$fabri_ciment)
  var_eco$fabri_autres_prod_manu = as.numeric(var_eco$fabri_autres_prod_manu)
  var_eco$prod_elec_gaz = as.numeric(var_eco$prod_elec_gaz)
  var_eco$prod_eau_assa = as.numeric(var_eco$prod_eau_assa)
  var_eco$construction = as.numeric(var_eco$construction)
  var_eco$VA_sec_ter = as.numeric(var_eco$VA_sec_ter)
  var_eco$commerce = as.numeric(var_eco$commerce)
  var_eco$transport = as.numeric(var_eco$transport)
  var_eco$hebergement_restauration = as.numeric(var_eco$hebergement_restauration)
  var_eco$information_communication = as.numeric(var_eco$information_communication)
  var_eco$activites_financieres_assurance = as.numeric(var_eco$activites_financieres_assurance)
  var_eco$activites_immobilieres = as.numeric(var_eco$activites_immobilieres)
  var_eco$services_aux_entreprises = as.numeric(var_eco$services_aux_entreprises)
  var_eco$activites_admin_pub_ens_sante = as.numeric(var_eco$activites_admin_pub_ens_sante)
  var_eco$activites_domestiques = as.numeric(var_eco$activites_domestiques)
  var_eco$autres_activites_services = as.numeric(var_eco$autres_activites_services)
  var_eco$taxes_nettes_produits = as.numeric(var_eco$taxes_nettes_produits)
  var_eco$VA_sec_prim = as.numeric(var_eco$VA_sec_prim)
}

write_dta(var_eco, 'data/variables_eco.dta')